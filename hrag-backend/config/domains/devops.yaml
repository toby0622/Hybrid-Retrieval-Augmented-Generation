# DevOps Domain Configuration
# For use with DevOps incident data and post-mortems (devops_schema.py)

name: devops
display_name: "DevOps Copilot"
description: "AI SRE for incident investigation and root cause analysis"
schema: devops  # References devops_schema.py

# Keywords for auto-detecting this domain from user queries
routing_keywords:
  - error
  - 錯誤
  - service
  - 服務
  - incident
  - 事件
  - outage
  - 宕機
  - latency
  - 延遲
  - timeout
  - 超時
  - crash
  - deployment
  - 部署
  - kubernetes
  - k8s
  - pod
  - container
  - 容器
  - cpu
  - memory
  - 記憶體
  - log
  - 日誌
  - metric
  - 指標
  - alert
  - 告警
  - sev1
  - sev2
  - production
  - 生產環境

# Intent classification
intents:
  - incident    # Investigating an outage or error
  - topology    # Service dependencies and architecture
  - status      # Checking system health
  - chat        # General conversation
  - end         # End conversation

intent_keywords:
  incident:
    - error
    - failed
    - crash
    - exception
    - timeout
    - latency
    - 500
    - slow
    - down
    - outage
    - 錯誤
    - 失敗
    - 當機
    - 問題
  topology:
    - depends
    - dependency
    - 依賴
    - architecture
    - 架構
    - upstream
    - downstream
    - connects
    - 連接
    - relationships
    - 關係
    - 拓撲
    - topology
    - 影響
    - affects
  status:
    - health
    - status
    - uptime
    - load
    - cpu
    - memory
    - 狀態
    - 健康

# Slot filling configuration
slots:
  required:
    - service_name
  optional:
    - error_type
    - environment
    - timestamp
    - trace_id
  examples:
    service_name:
      - "payment-api"
      - "auth-service"
      - "api-gateway"
      - "user-service"
      - "notification-service"
      - "payment-gateway"
    error_type:
      - "ConnectionRefused"
      - "NullPointerException"
      - "TimeoutError"
      - "500"
      - "OOM"
    environment:
      - "production"
      - "staging"
      - "k8s-cluster-1"

# Classification prompt configuration
classification_prompt:
  system_identity: |
    You are IntentClassifier, an AI component within the DevOps Copilot system.
    Your responsibility is to classify user messages about system incidents and operational status.
  capabilities:
    - Identify service outages and performance issues
    - Analyze error logs and stack traces
    - Check service health and dependencies
    - Search for similar past incidents

# Clarification prompt configuration  
clarification_prompt:
  system_identity: |
    You are an SRE Assistant helping to triage an incident.
    Your goal is to gather critical information like Service Name and Error Type quickly.
  examples:
    - known: "Error: Connection timeout"
      missing: "service_name"
      question: "Which service is experiencing the connection timeout? (e.g., auth-service, db-primary)"
    - known: "Service: payment-api"
      missing: "error_type, environment"
      question: "What specific error are you seeing in payment-api, and is this in production?"

# Reasoning prompt configuration
reasoning_prompt:
  system_identity: |
    You are DiagnosticReasoner, an expert Site Reliability Engineer (SRE).
    Your responsibility is to analyze incidents using the "Four Golden Signals" and topology data.
  capabilities:
    - Correlate errors across microservices
    - Identifying root causes from graph topology
    - Analyzing impact propagation
    - Recommending mitigation steps (restart, rollback, scale)

# Chat response configuration
chat_prompt:
  system_identity: |
    You are DevOps Copilot, a specialized SRE assistant.
    You help engineers diagnose production issues and maintain system reliability.
  capabilities:
    - Incident investigation and troubleshooting
    - Log analysis and pattern matching
    - Architecture dependency mapping
    - Post-mortem search

# Database queries
graph_queries:
  primary_search: |
    MATCH (s:Service)
    WHERE toLower(s.name) CONTAINS toLower($hint)
    OPTIONAL MATCH (s)-[r:DEPENDS_ON]-(dep:Service)
    OPTIONAL MATCH (inc:Incident)-[:AFFECTS]->(s)
    RETURN s.name as service, s.version as version,
           collect(distinct dep.name) as dependencies,
           collect(distinct inc.description) as recent_incidents
    LIMIT 5
    
  incident_search: |
    MATCH (inc:Incident)-[:AFFECTS]->(s:Service)
    WHERE toLower(s.name) CONTAINS toLower($hint)
       OR toLower(inc.description) CONTAINS toLower($hint)
    RETURN inc, s
    ORDER BY inc.created_at DESC
    LIMIT 10

# Vector search configuration
vector_filter_fields:
  - service
  - level    # log level
  - trace_id

# Response language
response_language: "zh-TW"
